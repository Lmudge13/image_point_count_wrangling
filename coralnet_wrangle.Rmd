---
title: "coralnet_wrangle"
author: "lkm"
date: "March 14, 2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

# What you need from coralnet:  
* your exported metadata file  
* your exported annotations file (data) 
* labelset .csv provided in the github repo  


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse) #install.packages(tidyverse)
library(janitor)

#check your working directory
getwd()

#change your working directory, if necessary. Should be the folder your data is stored in.
#setwd()
```

#Constants
```{r constants}

## This is where people define variable names, esp if they are specific to a filepath

#what the user should do:
#metadata <- "add filename path"

#data <- "add filename path"

#Here we are reading in the metadata and data files from the impage_point_count_wrangle github repo:

metadata <- read_csv("https://raw.githubusercontent.com/Lmudge13/image_point_count_wrangling/master/sample_metadata_coralnet.csv")

data <- read_csv("https://raw.githubusercontent.com/Lmudge13/image_point_count_wrangling/master/sample_data_annotations_simple_coralnet.csv")

labelset <- read_csv("https://raw.githubusercontent.com/Lmudge13/image_point_count_wrangling/master/coralnet_labelset.csv")

```

#Functions
```{r functions}

## add code for functions here

```

# How to put your data & metadata into one dataframe: 
```{r main}
## add the main code we want to run, here in this chunk

#read_csv(metadata variable from above)

#read_csv(data variable from above)


## Add the data & metadata .csv outputs from CoralNet:
pointcount <- dplyr::left_join(data, metadata, by ="Name")


## Add functional group column to pointcount dataset, using labelset provided by CoralNet (posted on github)

pointcount <- dplyr::left_join(pointcount, labelset, by ="Label")


## Tidy up the column names on the pointcount dataframe:
pointcount<- janitor::clean_names(pointcount)


# Take a look at your dataframe:
head(pointcount)
```

# Summarizing your pointcount data:
```{r summarize}

# Quick way to get a frequency count on a column of interest:
plyr::count(pointcount$Label)

#Count number of unique species in your dataset:

unique(pointcount$full_name)

```

## Calculate percent cover, using labels:  
* Across all sites  
* % cover by site  
* % cover by site and transect  

```{r labels}

# Percent cover of all labels, across all sites in your pointcount dataset:
pointcount %>%
  dplyr::group_by(label) %>%
  dplyr::summarise (n = n()) %>%
  dplyr::mutate(perc_cov = n / sum(n)*100)

# Percent cover of each label, for each site in the dataset:
pointcount %>%
  dplyr::group_by(site, label) %>%
  dplyr::summarise (n = n()) %>%
  dplyr::mutate(perc_cov = n / sum(n)*100)

# Percent cover of each label, by site & transect 
pointcount %>%
  dplyr::group_by(site, spur, label) %>%
  dplyr::summarise (n = n()) %>%
  dplyr::mutate(perc_cov = n / sum(n)*100)


```

## Calculate percent cover, based on functional groups:
* Across all sites  
* % cover by site  
* % cover by site and transect  
```{r functional}

# Percent cover of all functional groups, across all sites in your pointcount dataset:

pointcount %>%
  dplyr::group_by(functional_group) %>%
  dplyr::summarise (n = n()) %>%
  dplyr::mutate(perc_cov = n / sum(n)*100)


# Percent cover of each functional group, for each site in the dataset:
pointcount %>%
  dplyr::group_by(site, functional_group) %>%
  dplyr::summarise (n = n()) %>%
  dplyr::mutate(perc_cov = n / sum(n)*100)

# Percent cover of each functional group, by site & transect
pointcount %>%
  dplyr::group_by(site, transect, functional_group) %>%
  dplyr::summarise (n = n()) %>%
  dplyr::mutate(perc_cov = n / sum(n)*100)
```


